package com.malclean.admin.application.malware.malwarefile;

import com.malclean.admin.domain.malware.malwarefile.*;
import com.malclean.admin.domain.malware.malware.Malware;
import com.malclean.admin.infrastructure.malware.malwarefile.SignatureCreator;
import com.malclean.admin.domain.malware.malwarefile.service.StoreManager;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import java.util.List;
import java.util.stream.Collectors;

@RequiredArgsConstructor
@Slf4j
@Service
public class MalwareFileSaveService {

    private final MalwareFileBulkRepository malwareFileBulkRepository;

    private final StoreManager localStoreManager;

    private final SignatureCreator signatureCreator;

    @Transactional
    public void saveMalwareFileList(Malware malware, List<MultipartFile> fileList, Long loginMemberId) {

        List<MalwareFile> malwareFileList = fileList.stream()
                .map(file -> MalwareFile.builder()
                        .signature(signatureCreator.createSignature(file))
                        .filename(file.getOriginalFilename())
                        .malware(malware)
                        .build())
                .collect(Collectors.toList());

        malwareFileBulkRepository.saveAll(malwareFileList, loginMemberId);

        //todo 저장로직
    }
}