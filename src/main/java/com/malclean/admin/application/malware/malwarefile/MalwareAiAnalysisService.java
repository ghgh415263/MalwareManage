package com.malclean.admin.application.malware.malwarefile;

import com.malclean.admin.application.common.exception.NotExistEntityException;
import com.malclean.admin.domain.malware.malwarefile.MalwarefileRepository;
import com.malclean.admin.domain.malware.malwarefile.Malwarefile;
import com.malclean.admin.domain.malware.malwarefile.service.AnalysisResultRes;
import com.malclean.admin.domain.malware.malwarefile.service.MalwareFileAnalysisClient;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

@RequiredArgsConstructor
@Slf4j
@Service
public class MalwareAiAnalysisService {

    private final MalwareFileAnalysisClient malwareFileAnalysisClient;

    private final MalwarefileRepository malwareFileRepository;

    public AnalysisResultRes analyze(Long malwarefileId, Integer modelId) {
        Malwarefile malwareFile = malwareFileRepository.findById(malwarefileId)
                .orElseThrow(NotExistEntityException::new);
        return malwareFileAnalysisClient.analyzeMalwareFile(malwareFile.getStoreFilename(), modelId);
    }
}
