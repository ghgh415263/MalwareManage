package com.malclean.admin.application.malware.malwarefile;

import com.malclean.admin.domain.malware.malwarefile.MalwareFileRepository;
import com.malclean.admin.domain.malware.malwarefile.Malwarefile;
import com.malclean.admin.domain.malware.malwarefile.service.AnalysisResultResponse;
import com.malclean.admin.domain.malware.malwarefile.service.MalwareFileAnalysisClient;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

@RequiredArgsConstructor
@Slf4j
@Service
public class MalwareAiAnalysisService {

    private final MalwareFileAnalysisClient malwareFileAnalysisClient;

    private final MalwareFileRepository malwareFileRepository;

    public AnalysisResultResponse analyze(Long malwarefileId, Integer modelId) {
        Malwarefile malwareFile = malwareFileRepository.findById(malwarefileId)
                .orElseThrow(() -> new RuntimeException("엔티티가 존재하지 않음"));
        return malwareFileAnalysisClient.analyzeMalwareFile(malwareFile.getStoreFilename(), modelId);
    }
}
