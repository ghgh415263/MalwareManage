package com.malclean.admin.application.member;

import com.malclean.admin.domain.member.Member;
import com.malclean.admin.domain.member.AuthorityType;
import com.malclean.admin.infrastructure.member.MemberRepository;
import lombok.Getter;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityNotFoundException;

@RequiredArgsConstructor
@Slf4j
@Service
public class MemberDetailService {

    private final MemberRepository memberRepository;

    @Transactional(readOnly = true)
    public MemberPageResponse findMember(Long wantedMemberId, Long loginMemberId) {

        Member wantedMember = memberRepository.findById(wantedMemberId)
                .orElseThrow(()->new EntityNotFoundException());

        //todo 개인정보를 받아오는 서버가 생기면 바꿔야함11

        if (wantedMember.getId() != loginMemberId) {
            return MemberPageResponse.createOtherMemberPage(wantedMember);
        }

        return MemberPageResponse.createMyMemberPage(wantedMember);
    }

    @Getter
    public static class MemberPageResponse {

        private String username;

        private AuthorityType authority;

        private MemberPageResponse(String username, AuthorityType authority) {
            this.username = username;
            this.authority = authority;
        }

        public static MemberPageResponse createMyMemberPage(Member member){
            return new MemberPageResponse(member.getUsername(), member.getAuthority());
        }

        public static MemberPageResponse createOtherMemberPage(Member member){
            return new MemberPageResponse(member.getUsername(), member.getAuthority());
        }
    }

}
