package com.malclean.admin.announcement.application;

import com.malclean.admin.announcement.domain.Announcement;
import com.malclean.admin.exception.NoAuthorityForEntity;
import com.malclean.admin.announcement.domain.DslAnnouncementRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityNotFoundException;

@RequiredArgsConstructor
@Slf4j
@Service
public class AnnouncementEditService {

    private final DslAnnouncementRepository dslAnnouncementRepository;

    @Transactional
    public void edit(Long announcementId, AnnouncementEditRequest announcementEditRequest, String sessionUsername) {

        Announcement announcement = dslAnnouncementRepository.findByIdWithMember(announcementId)
                .orElseThrow(()->new EntityNotFoundException()); // 깃 연습

        if (announcement.getPoster().getUsername() != sessionUsername) {
            throw new NoAuthorityForEntity("공지사항에 대한 수정권한이 없습니다.");
        }

        announcement.editTitle(announcementEditRequest.getTitle());
        announcement.editContent(announcementEditRequest.getContent());
        announcement.editAnnouncementStatus(announcementEditRequest.getAnnouncementStatus());
    }
}
