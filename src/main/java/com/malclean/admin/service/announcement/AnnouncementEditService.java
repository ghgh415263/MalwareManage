package com.malclean.admin.service.announcement;

import com.malclean.admin.entity.Announcement;
import com.malclean.admin.repository.announcement.DslAnnouncementRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityNotFoundException;

@RequiredArgsConstructor
@Slf4j
@Service
public class AnnouncementEditService {

    private final DslAnnouncementRepository dslAnnouncementRepository;

    @Transactional
    public void edit(Long announcementId, AnnouncementEditRequest announcementEditRequest, String sessionUsername) {

        Announcement announcement = dslAnnouncementRepository.findByIdWithMember(announcementId)
                .orElseThrow(()->new EntityNotFoundException());

        if (announcement.getPoster().getUsername() != sessionUsername) {
            throw new RuntimeException();
        }

        announcement.editTitle(announcementEditRequest.getTitle());
        announcement.editContent(announcementEditRequest.getContent());
        announcement.editAnnouncementStatus(announcementEditRequest.getAnnouncementStatus());
    }
}
