import { getMembers } from './member-client.js';
import { PaginationBar } from "../PaginationBar.js";
import { PageableList } from "../pageable-list.js";

window.onload = () => {

    const $fileAppendButton = document.getElementById('btn_file_append');
    $fileAppendButton.addEventListener('click', (e)=> {

        const $tr = document.createElement('tr');
        $tr.insertAdjacentHTML("beforeend", `
            <td><input type="file" name="multipartFileList" class="form-control"></td>
            <td><button type="button" class="btn_delete btn btn-sm">삭제</button></td>`
        )
        document.querySelector('.file_list')
            .appendChild($tr)
    })

    document.querySelector('.file_list')
        .addEventListener('click', (e)=> {
            e.target.closest('tr').remove();
        })

    const $paginationBarWapper = document.querySelector('.paging');
    const paginationBar = new PaginationBar($paginationBarWapper);
    const $listWapper = document.querySelector('.list-group');
    const pageableList = new PageableList($listWapper, new MemberTagFactory());

    const $memberModal = document.getElementById('memberModal');
    $memberModal.addEventListener('shown.bs.modal', async () => {
        const pageable = await getMembers(1);
        paginationBar.renderPaginationBar(pageable.customPageable)
        pageableList.renderList(pageable.content)
    })

    $paginationBarWapper.addEventListener('click', async (e) => {

        const page = e.target.dataset.page;
        if (!page) {
            return;
        }

        const pageable = await getMembers(page);
        paginationBar.renderPaginationBar(pageable.customPageable);
        pageableList.renderList(pageable.content);
    });



    let myModal = new bootstrap.Modal($memberModal, {
        keyboard: false
    })
    let $memberBars = document.querySelector('.list-group');
    $memberBars.addEventListener('click', function clickMember(event) {
        let $input = document.getElementById('assigneeId');
        $input.value = event.target.dataset.memberId
        myModal.hide();
    })
}

class MemberTagFactory{
    createTag(member) {
        const $tr = document.createElement('tr');
        $tr.insertAdjacentHTML("beforeend", `
            <a class="list-group-item list-group-item-action" data-bs-toggle="list" role="tab" aria-controls="list-home" data-member-id="${member.id}">
                유저이름: ${member.username}  부서: ${member.department}
            </a>`
        );
        return $tr;
    }
}