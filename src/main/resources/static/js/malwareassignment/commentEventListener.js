import { getNextCommentList } from './GetCommentList.js';
import { postComment } from './PostComment.js';
import { DeleteComment } from "./DeleteComment.js";
import { PatchComment } from "./PatchComment.js";

window.onload  = () => {
    getNextCommentList(null);
}


document.getElementsByClassName('btn').item(1)
    .addEventListener('click', (event) => {
        const lastCommentId = $(".list-group li").last().data("id");
        getNextCommentList(lastCommentId);
    })

document.getElementsByClassName('btn').item(0)
    .addEventListener('click', (event) => {
        postComment().then((response) => {
            if (response.ok) {
                $(".list-group li").each(function(){
                    $(this).remove();
                });
                getNextCommentList(null);
            }
        })
    })

$(document).on("click", ".comment-delete-btn", function (event) {
    const $li = event.target.closest('li');
    const id = $li.dataset.id;
    DeleteComment(id).then((response) => {
        if (response.ok) {
            $(".list-group li").each(function(){
                $(this).remove();
            });
            getNextCommentList(null)
        }
    })
});


$(document).on("click", ".comment-patchForm-btn", function (event) {

    const $li = event.target.closest('li');
    const id = $li.dataset.id;

    const $textarea = document.createElement('textarea');
    $textarea.setAttribute('id', 'comment-updatedContent');
    $textarea.innerText = id;

    const $updateButton = document.createElement('button');
    $updateButton.setAttribute('class', 'comment-patch-btn');
    $updateButton.innerText = "수정";

    $li.innerHTML = "";
    $li.append($textarea, $updateButton);
});

$(document).on("click", ".comment-patch-btn", function (event) {
    const $li = event.target.closest('li');
    const id = $li.dataset.id;
    PatchComment(id).then((response) => {
        if (response.ok) {
            $(".list-group li").each(function(){
                $(this).remove();
            });
            getNextCommentList(null)
        }
    })
});