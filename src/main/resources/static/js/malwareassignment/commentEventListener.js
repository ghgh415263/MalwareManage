import { getCommentList } from './GetCommentList.js';
import { renderComments } from "./makeCommentTag.js"
import { PaginationBar } from "../PaginationBar.js";
import {deleteComment} from "./DeleteComment.js";
import {postComment} from "./PostComment.js";

window.onload = async () => {
    const customPage = await getCommentList(1)

    const $listWapper = document.querySelector('.list-group');
    const $paginationBarWapper = document.querySelector('.paging');

    const paginationBar = new PaginationBar($paginationBarWapper);
    renderComments(customPage.content, $listWapper)
    paginationBar.renderPaginationBar(customPage.customPageable)

    $paginationBarWapper.addEventListener('click', async (e) => {

        const page = e.target.dataset.page;
        if (!page) {
            return;
        }

        const pageable = await getCommentList(page);
        renderComments(pageable.content, $listWapper)
        paginationBar.renderPaginationBar(pageable.customPageable);
    });

    $listWapper.addEventListener('click', async (e) => {

        const commentId = e.target.parentNode.dataset.id
        await deleteComment(commentId);

        const pageable = await getCommentList(1);
        renderComments(pageable.content, $listWapper)
        paginationBar.renderPaginationBar(pageable.customPageable);
    })

    const $commentSubmitButton = document.getElementById("comment-submit-btn");
    $commentSubmitButton.addEventListener('click', async (e) => {

        const commentContent = document.getElementById("comment-content").value;

        await postComment(commentContent);

        const pageable = await getCommentList(1);
        renderComments(pageable.content, $listWapper)
        paginationBar.renderPaginationBar(pageable.customPageable);
    })
}