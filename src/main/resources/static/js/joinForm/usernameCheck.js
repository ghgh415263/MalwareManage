import { joinValidator } from './joinValidator.js';
const usernameCheck = async (usernameValue, $checkFlag) => {

    const result = await usernameCheckRequester(usernameValue);

    if (result.isDuplicated) {
        alert("이미 사용중인 아이디입니다.");
        return
    }

    $checkFlag.value = "isNotDuplicated";
    alert("아이디를 사용해도 좋습니다.");
}

async function usernameCheckRequester(usernameValue){
    let url = '/members/check?username=' + usernameValue;
    let options = {
        method: 'GET',
        mode: 'cors',
        headers: {
            'Accept': 'application/json'
        }
    };
    return (await fetch(url, options)).json()
}


document.getElementById('checkDuplicateUsernameBtn').addEventListener('click', (event) => {
    const usernameValue = document.getElementById('username').value
    const validator = new joinValidator()

    if (!validator.validateUsername(usernameValue)) {
        alert("영문자와 숫자로 조합된 아이디를 입력해주세요.");
        return
    }
    usernameCheck(usernameValue, document.getElementById("username-check-flag"))

})

document.getElementById('username').addEventListener('change', (event) => {
    document.getElementById("username-check-flag").value = "isDuplicated";
})