import { joinValidator } from './joinValidator.js';
const usernameCheck = (usernameValue, $checkFlag) => {

    let url = '/members/check?username=' + usernameValue;
    let options = {
        method: 'GET',
        mode: 'cors',
        headers: {
            'Accept': 'application/json'
        }
    };

    fetch(url, options)
        .then((response) => {
            if (response.ok) {
                return response.json();
            }
        })
        .then((result) => {
            if (result.isDuplicated) {
                alert("이미 사용중인 아이디입니다.");
            } else {
                $checkFlag.value = "isNotDuplicated";
                alert("아이디를 사용해도 좋습니다.");
            }
        })
}


document.getElementById('checkDuplicateUsernameBtn').addEventListener('click', (event) => {
    const $usernameInput = document.getElementById('username')
    const usernameValue = $usernameInput.value
    const validator = new joinValidator()
    const $checkFlag = document.getElementById("username-check-flag");

    if (validator.validateUsername(usernameValue)) {
        usernameCheck(usernameValue, $checkFlag)
    }
    else {
        alert("잘못된 아이디입니다.");
    }

})

document.getElementById('username').addEventListener('change', (event) => {
    document.getElementById("username-check-flag").value = "isDuplicated";
})