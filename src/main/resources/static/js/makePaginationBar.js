import {getCommentList} from "./malwareassignment/GetCommentList.js";
import {renderComments} from "./malwareassignment/makeCommentTag.js";

export const renderPaginationBar = (pageable, wapper) => {

    let $ul = document.createElement('ul');
    $ul.classList.add('pagination','justify-content-center')

    // 페이지네이션 HTML을 제거한 후 로직 종료
    if ( pageable.totalPages < 2 ) {
        return $ul;
    }

    // 3. 첫/이전 페이지 버튼 추가
    if (pageable.hasPrevious) {
        $ul.appendChild(makePreviousBtn(pageable.page-1))
    }

    // 4. 페이지 번호 추가
    for (let i = 1; i <= pageable.totalPages; i++) {
        $ul.appendChild(makePageBtn(i))
    }

    // 5. 다음/끝 페이지 버튼 추가
    if (pageable.hasNext) {
        $ul.appendChild(makeNextBtn(pageable.page+1))
    }

    const currentPage = Array.from($ul.querySelectorAll('a')).find(a => (Number(a.text) === pageable.page));
    currentPage.classList.add('disabled')

    Array.from($ul.querySelectorAll('a'))
        .forEach($a => {
            $a.addEventListener('click', async function (event){
                const page = event.target.dataset.page;
                const pageable = await getCommentList(page);

                const $listWapper = document.querySelector('.list-group');
                renderComments(pageable.content, $listWapper)
                renderPaginationBar(pageable.customPageable, wapper);
            })
        })

    wapper.replaceChildren($ul)
}
function makePreviousBtn(page) {

    let $li = document.createElement('li');
    $li.setAttribute('class','page-item');

    $li.insertAdjacentHTML("beforeend", `
        <a href="javascript:void(0);" id="prev" class="page-link" data-page="${page}">
            이전
        </a>`
    );

    return $li
}

function makePageBtn(page){

    let $li = document.createElement('li');
    $li.setAttribute('class','page-item');

    $li.insertAdjacentHTML("beforeend", `
        <a class="page-link" href="javascript:void(0);" data-page="${page}">${page}</a>`
    );



    return $li
}

function makeNextBtn(page) {

    let $li = document.createElement('li');
    $li.setAttribute('class','page-item');

    $li.insertAdjacentHTML("beforeend", `
        <a href="javascript:void(0);" id="next" class="page-link" data-page="${page}">
            다음
        </a>
    `);

    return $li
}