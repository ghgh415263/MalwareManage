package com.malclean.admin.dao;

import com.malclean.admin.TestAuditingConfig;
import com.malclean.admin.dao.announcement.AnnouncementDetailDao;
import com.malclean.admin.dao.announcement.responsedto.AnnouncementDetailRes;
import com.malclean.admin.domain.announcement.Announcement;
import com.malclean.admin.domain.announcement.enums.AnnouncementStatusType;
import com.malclean.admin.domain.member.Member;
import com.malclean.admin.helper.TestMemberFactory;
import com.malclean.admin.infrastructure.announcement.AnnouncementDetailDaoImpl;
import com.querydsl.jpa.impl.JPAQueryFactory;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;
import org.springframework.context.annotation.Import;

import javax.persistence.EntityManager;

import static org.assertj.core.api.AssertionsForClassTypes.assertThat;

@DataJpaTest
@Import(TestAuditingConfig.class)
public class AnnouncementDetailDaoTest {

    @Autowired
    private TestEntityManager tem;

    private AnnouncementDetailDao announcementDetailDao;

    @BeforeEach
    public void beforeEach() {
        EntityManager em = tem.getEntityManager();
        announcementDetailDao = new AnnouncementDetailDaoImpl(new JPAQueryFactory(em));
    }

    @Test
    void 상세_가져오기(){
        Member member = TestMemberFactory.createMember();
        tem.persist(member);

        Announcement announcement = new Announcement("testTitle", "testContent", AnnouncementStatusType.IMPORTANT);
        tem.persist(announcement);

        AnnouncementDetailRes res = announcementDetailDao.findDetail(1L).get();

        assertThat(res.getId())
                .isEqualTo(1l);
    }
}
